<!DOCTYPE html>
<html ng-app="app">
	<head>
		<title>AngularJS Calendar</title>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
	</head>
	<body>
		<div class="container">
			<h1>Calendar</h1>
			<div class="row">
				<div class="col-md-12" ng-controller="Ctrl">
					<table class="table table-striped">
						<thead>
							<tr>
								<td ng-repeat="day in days">{{ day.substr(0,2) }}</td>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="week in calendar.weeks track by $index">
								<td ng-repeat="day in week.days track by $index">{{ day.text }}</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0/angular.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment-with-locales.min.js"></script>
		<script type="text/javascript">
			var app = angular.module('app', []);
			app.controller('Ctrl', function($scope) {
				var self = this;
				$scope.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
				$scope.weeks = [1,2,3,4,5];
				
				var init = function(startMonth, startYear){
					var outputFormat = "MM-DD-YYYY";
					var now = moment();
					console.log('current date is %s', moment().format(outputFormat));
					//construct first date object
					var start = moment({ y:startYear, M:startMonth - 1, d:1 });
					//work out day offset from sunday
					var startOffset = start.day();
					//use offset to start loop part way in first row
					$scope.startDay = $scope.days[startOffset];
					console.log('starting calendar on %s',start.format(outputFormat));
					console.log('startOffset:%i day is %s',startOffset, $scope.startDay);
					
					var day = 1;
					var weekCount = 6;
					var totalCells = weekCount * 7;
					var weeks = new Array(weekCount);
					var weekIndex = 0;
					var weekdayIndex = 0;
					var currentWeek;
					var currentDay;
					var totalDaysInMonth = 31; //TODO
					
					var month = {
						startOffset : startOffset,
						totalDays : totalDaysInMonth,
						days : [],
						init : function(month, year){
							for(var day = 1; day <= totalDaysInMonth; day++){
								this.days.push({
									display : day
								})
							}
						}
					};
					
					var calendar = {
						weeks : [],
						init : function(startOffset, daysInMonth){
							var cell = 0;
							var currentDay = 1;
							for(var wx = 0; wx < 6; wx++){
								var week = {
									days : []
								};
								for(var dx = 0; dx < 7; dx++){
									
									var dayText = '';
									if(cell >= startOffset && currentDay <= daysInMonth){
										dayText = currentDay.toString();
										currentDay++;
									}
									week.days.push({
										text : dayText
									});
									cell++;
									
								}
								this.weeks.push(week);
							}
							
						}	
					};
					
					calendar.init(6, 31);
					console.log('calendar %o', calendar);
					$scope.calendar = calendar;
					
					/*for(var i = 0; i < totalCells; i++){
										
						if(weekdayIndex == 0){
							//initialise week
							currentWeek = {
								days : []
							};
						}
																		
						console.log('week %i, weekday %i, cell %i, day %i', weekIndex, weekdayIndex, i, day);
						
						//skip days until 1st of month
						if(i < startOffset || day > totalDaysInMonth){
								continue;
						}
						
											
						
						day++;
						weekdayIndex++;
						
						if(weekdayIndex == 7){
							weekIndex++;
						}
					}*/
				};
				
				init(8,2015);
			});
		</script>
	</body>

</html>